generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int       @id
  username   String    @map("user") @db.VarChar(20)
  password   String    @db.VarChar(220)
  created_at DateTime? @default(now()) @db.Date
  updated_at DateTime? @default(now()) @db.Date
  rol        roles?

  @@map("users")
}

model Client {
  id                     Int                  @id @default(autoincrement())
  business_name          String
  whatsapp_instance_id   String               @unique
  is_active              Boolean              @default(true)
  system_prompt_template String
  tools_config           Json?                @default("{}")
  created_at             DateTime             @default(now())
  password_hash          String
  whatsapp_access_token  String?
  whatsapp_app_secret    String?
  whatsapp_api_version   String?              @default("v21.0")
  bot_disabled_by_admin  Boolean              @default(false)
  notification_email     String?              @db.VarChar
  appointments           Appointment[]
  email_settings         ClientEmailSettings?
  customers              Customer[]

  @@map("clients")
}

model ClientEmailSettings {
  id              Int     @id @default(autoincrement())
  client_id       Int     @unique
  primary_color   String  @default("#333333") @db.VarChar(50)
  secondary_color String  @default("#666666") @db.VarChar(50)
  logo_url        String?
  sender_name     String?
  footer_text     String?
  templates       Json?   @default("{}")
  client          Client  @relation(fields: [client_id], references: [id], onDelete: Cascade)

  @@map("client_email_settings")
}

model Customer {
  id           Int           @id @default(autoincrement())
  client_id    Int
  phone_number String
  full_name    String?
  data         Json?         @default("{}")
  created_at   DateTime      @default(now())
  appointments Appointment[]
  client       Client        @relation(fields: [client_id], references: [id])

  @@index([client_id])
  @@index([phone_number])
  @@map("customers")
}

model Appointment {
  id              Int      @id @default(autoincrement())
  client_id       Int
  customer_id     Int
  google_event_id String?  @unique
  start_time      DateTime
  end_time        DateTime
  status          String   @default("CONFIRMED")
  notes           String?
  client          Client   @relation(fields: [client_id], references: [id])
  customer        Customer @relation(fields: [customer_id], references: [id])

  @@index([client_id])
  @@index([customer_id])
  @@map("appointments")
}

enum roles {
  admin
  empleado
}
